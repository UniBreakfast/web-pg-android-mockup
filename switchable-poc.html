<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Elements Switchable By Mode - Proof of concept</title>
  <style>
    .mode:not(.active) { display: none }
  </style>
  <script>
    const upd = {},
          app = { backSteps: [], back() {
      if (app.backSteps.length) app.backSteps.pop()()
    }, properties: [{name: {first: 'John', last: 'Doe'}, age: 33, height: 178}, {name: {first: 'Jane', last: 'Day'}, age: 30, height: 170}, ] }
    // }, properties: {name: 'John', age: 33, height: 178} }
    // - will become [{key: "name", val: "John", i: 0}, {key: "age", val: 33, i: 1}, {key: "height", val: 178, i:2}]
    onload = () => {
      document.querySelectorAll('.switchable').forEach(area =>
        (area.switch = (mode, backable=1) => {
          area.querySelectorAll('.mode').forEach(el => {
            const id = area.id.toLowerCase()
            if (!el.dataset[id]) return
            if (el.dataset[id] != mode) return el.classList.remove('active')
            el.classList.add('active')
            if (el.render) el.render()
          })
          if (backable) {
            const current = area.dataset.active
            app.backSteps.push(()=> {
              area.switch(current, 0)
              if (typeof backable == 'function') backable()
            })
          }
          area.dataset.active = mode
        })(area.dataset.active, 0)
      )
      
      document.querySelectorAll('.renderable').forEach(area => {
        const template = area.innerHTML,
              source = app[area.dataset.src],
              placeholders = [...new Set(template.match(/\{.+?\}/g))]
                .reduce((dic, holder) => ({...dic, [holder]: holder
                  .split(/[.{}[\]]/g).filter(v => v)}), {});
        
        (area.render = () => {
          const src = Array.isArray(source)? source : 
                Object.entries(source).map(([key, val], i) => ({key, val, i})),
                placeValues = src.map(props => Object.entries(placeholders)
                  .reduce((dic, [holder, path]) => ({...dic, [holder]: path
                    .reduce((val, prop) => val[prop], props)}), {}))

          area.innerHTML = placeValues.reduce((html, dic) => html + 
            Object.entries(dic).reduce((html, [holder, value]) => 
              html.split(holder).join(value), template), '')
        })()
        
        var trottler = 0
        Object.defineProperty(upd, area.dataset.src, { get: () => 
          (clearTimeout(trottler), trottler = setTimeout(area.render, 0), source)})
      })
    } 
  </script>
</head>
<body>
  <div class="container switchable" id="appArea" data-active="inside">
    <div class="mode" data-appArea="lobby">
      <div>Title</div>
      <button onclick="appArea.switch('auth'); authArea.switch('login', 0)">
        Login</button>
      <button onclick="appArea.switch('auth', ()=>authArea.switch('login', 0));
                       authArea.switch('reg', 0)">
        Register</button>
    </div>
    <div class="switchable mode" id="authArea" data-active="login"
        data-appArea="auth">
      <div class="mode" data-authArea="login">Please login below</div>
      <div class="mode" data-authArea="reg">Please register below</div>
      <div class="subcontainer">
        <div class="mode" data-authArea="login">Forgot your password?</div>
        <div class="mode" data-authArea="reg">Type your password twice!</div>
      </div>
      <button onclick="appArea.switch('inside')">
        <span class="mode" data-authArea="login">Log in</span>
        <span class="mode" data-authArea="reg">Register</span>
      </button>
    </div>
    <div class="mode" data-appArea="inside">
      Your are inside now
      <div class="renderable" data-src="properties" id=it>
        <div>
          <!-- <span>{i}.</span> <b>{key}</b>: <i>{val}</i> -->
          <b>{name.first} {name.last} {age}({name.first[0]}.{name.last[0]}.)</b>: <i>{age}/{height}</i>
        </div>
      </div>
    </div>
  </div>
  <button onclick="app.back()">back</button>
</body>
</html>